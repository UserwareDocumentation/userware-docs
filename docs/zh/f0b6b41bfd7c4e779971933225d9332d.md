# 入门指南

## 主题：
- [如何开始？](#如何开始)
- [是否有示例项目？](#是否有示例项目)
- [有哪些已知限制？](#有哪些已知限制)
- [故障排除 – 如果不能工作怎么办？](#故障排除--如果不能工作怎么办)
- [如何在我的 Blazor 项目中创建新的 XAML 文件？](#如何在我的-blazor-项目中创建新的-xaml-文件)
- [如何从 Razor 注册 XAML 事件？](#如何从-razor-注册-xaml-事件)
- [分步教程（从 A 到 Z）](#分步教程从-a-到-z)
- [如果我还有其他问题怎么办？](#如果我还有其他问题怎么办)

---

## 如何开始？

**非常简单！**

1. **在您的 Blazor WebAssembly 项目中引用** ["XAML for Blazor" 包](https://www.nuget.org/packages/XamlForBlazor)  
   *（注意："Blazor Server" 支持正在规划中）。*
2. **可选安装** [此 VSIX](https://marketplace.visualstudio.com/items?itemName=userware.XamlForBlazor)，它会为 Visual Studio 2022 添加项目模板。这允许您通过**"添加新项"对话框**在 Blazor 项目中创建新的 XAML 文件。
3. **将 XAML 文件添加**到您的 Blazor WebAssembly 项目中。  
   *（注意：如果您从磁盘复制/粘贴 XAML 文件，请确保将其"生成操作"设置为"Content"或"Page"，而不是"None"。）*
4. **通过以下代码从 Razor 页面实例化您的 XAML 控件**（或内置类型，如 DataGrid、DataForm 等）：
   
   ```razor
   <XamlForBlazor.XamlElement Type="typeof(UserControl1)" />
   ```

5. **传递值和注册事件**：
   
   ```razor
   <XamlForBlazor.XamlElement 
       Type="typeof(UserControl1)" 
       MyXamlProperty="@myBlazorValue" 
       ExampleOfEvent="@UserControl1_MyEventHandler" />
   ```
   
   *（记住在传递动态值或事件处理程序时使用"@"符号。）*

---

## 是否有示例项目？

是的，在 GitHub 上提供了一个带有一些 XAML 文件的简单 Blazor WebAssembly 应用程序（"Hello World"）：  
[**GitHub 上的 Xaml for Blazor 示例**](https://github.com/OpenSilver/XamlForBlazorExample1)。  
此源代码对应于[本教程](#分步教程从-a-到-z)。

---

## 有哪些已知限制？

- 目前仅支持 **Blazor WebAssembly**  
  *（"Blazor Server" 支持正在规划中）*。
- 需要 **.NET 7** 或 **.NET 8**。仅在 **Windows 上的 Visual Studio 2022** 上测试过。
- XAML 和 Razor 文件可以在同一项目中**并存**，但目前还不能在单个文件中混合使用代码片段。
- 支持的 XAML 方言是 **Microsoft Silverlight**（[文档](https://learn.microsoft.com/en-us/previous-versions/windows/silverlight/dotnet-windows-silverlight/cc838158(v=vs.95))），这是 **WPF** 的浏览器友好子集。  
  从 **WPF**、**UWP** 或 **WinUI** 移植相对容易；从 **Xamarin Forms** 或 **.NET MAUI** 移植需要更多工作。  
  如需迁移服务，请联系 [Userware](https://xaml-for-blazor.com/about-us/)。

---

## 故障排除 – 如果不能工作怎么办？

检查先决条件：

- 确认您的项目是 **Blazor WebAssembly**。
- 确认您的项目使用 **.NET 7** 或 **.NET 8**  
  *（检查 .CSPROJ 文件中的 `<TargetFramework>` 标签，例如 `<TargetFramework>net7.0</TargetFramework>`）*。
- 更新到最新版本的 **Visual Studio 2022**。
- 确保您在 **Windows** 上运行。
- 确保您的项目引用了 ["XAML for Blazor" 包](https://www.nuget.org/packages/XamlForBlazor)。
- 确保安装了 [VSIX](https://marketplace.visualstudio.com/items?itemName=userware.XamlForBlazor)（用于"添加新项"对话框）。

此外：

- **查看浏览器控制台是否有错误消息**（按 F12、Ctrl+Shift+I 或打开开发者工具并查看控制台）。
- 验证 XAML 文件的**生成操作**设置为 **Content** 或 **Page**。  
  *（在 Visual Studio 中，在解决方案资源管理器中选择文件，按 F4 查看属性，并将"生成操作"设置为"Content"。同时，确保"自定义工具"设置为"MSBuild:Compile"。）*
- **清除浏览器缓存并重新加载。**  
  *（右键单击重新加载按钮（在开发者工具打开的情况下）并选择"清空缓存并硬性重新加载"。）*
- 清理浏览器的 **WebAssembly 应用程序缓存存储**。  
  *（在开发者工具中，在"应用程序"标签下，展开"缓存存储"，右键单击其内容并选择"删除"。）*

如果问题仍然存在，请联系：  
[xaml-for-blazor@userware.onmicrosoft.com](mailto:xaml-for-blazor@userware.onmicrosoft.com)

---

## 如何在我的 Blazor 项目中创建新的 XAML 文件？

安装 [VSIX](https://marketplace.visualstudio.com/items?itemName=userware.XamlForBlazor) 并引用 ["XAML for Blazor" 包](https://www.nuget.org/packages/XamlForBlazor) 后，您将在**添加新项**对话框中看到项目模板：

1. 在解决方案资源管理器中右键单击您的项目。
2. 点击**添加**然后**新建项...**。

您应该会看到这些选项。

*（如果这些选项没有出现，请确保已安装 [VSIX](https://marketplace.visualstudio.com/items?itemName=userware.XamlForBlazor)。）*

---

## 如何从 Razor 注册 XAML 事件？

由于 XAML 和 Razor 共享相同的 DOM、内存和线程，您可以轻松地在它们之间传递对象并注册事件。

示例（在 *Counter.razor* 中）：
```razor
@page "/counter"

<PageTitle>Counter</PageTitle>

<h1>Counter</h1>

<p role="status">当前计数：@currentCount</p>

<!-- 加载 XAML 控件并注册事件 -->
<XamlForBlazor.XamlElement 
    Type="typeof(System.Windows.Controls.Button)" 
    Content="点击我" 
    Click="@Button_Click" 
    FontSize="16" />

<!-- 默认 Blazor 按钮 -->
<button class="btn btn-primary" @onclick="IncrementCount">点击我</button>

@code {
    private int currentCount = 0;

    private void IncrementCount()
    {
        currentCount++;
    }

    private void Button_Click(object sender, System.Windows.RoutedEventArgs e)
    {
        currentCount++;
        base.StateHasChanged();
        System.Windows.MessageBox.Show("还记得旧时的消息框吗？");
    }
}
```

---

## 分步教程（从 A 到 Z）：

1. **安装 VSIX**  
   安装[这个可选的 VSIX](https://marketplace.visualstudio.com/items?itemName=userware.XamlForBlazor) 以将项目模板添加到 Visual Studio 的添加新文件对话框中。

2. **创建新的 Blazor WebAssembly 应用程序**  
   在 Visual Studio 2022 中，创建一个名为 **"BlazorApp1"** 的新 Blazor WebAssembly 应用程序。

3. **添加对 "XAML for Blazor" 包的引用**  
   - 右键单击项目，选择**管理 NuGet 包...**，搜索 "xaml for blazor"，然后点击**安装**。
   - 或者，将此行添加到您的 CSPROJ 文件中：
     
     ```xml
     <PackageReference Include="XamlForBlazor" Version="1.2.*" />
     ```

4. **尝试使用 XAML！**  
   编辑 **FetchData.razor**，添加以下内容：
   
   ```xml
   <!-- 只读的 DataGrid 和可编辑的 DataForm -->
   <XamlForBlazor.XamlElement 
       Type="typeof(System.Windows.Controls.DataGrid)"
       ItemsSource="@forecasts"
       IsReadOnly="True" />
   <XamlForBlazor.XamlElement 
       Type="typeof(System.Windows.Controls.DataForm)"
       ItemsSource="@forecasts"
       Width="300" />
   ```
   
   ![XamlElement Tag Example](https://i0.wp.com/xaml-for-blazor.com/wp-content/uploads/2023/07/Tutorial-XamlElement-tag-Smaller.png?resize=716%2C455&ssl=1)
   ![Interop between XAML and Razor](https://i0.wp.com/xaml-for-blazor.com/wp-content/uploads/2023/07/Tutorial-Interop-between-XAML-and-Razor1.png?resize=956%2C582&ssl=1)
   
   *注意：* 要在编辑 DataForm 时更新 Blazor HTML 表格，需注册 **EditEnded** 事件并调用 `StateHasChanged()`。
   
   如果需要，您可以在您的模型（例如 "WeatherForecast"）中实现 **INotifyPropertyChanged** 以实现自动更新。

   Screenshots:
   - ![Edit FetchData](https://i0.wp.com/xaml-for-blazor.com/wp-content/uploads/2023/07/Tutorial-Edit-FetchData.png?resize=323%2C371&ssl=1)
   - ![DataGrid and DataForm Example](https://i0.wp.com/xaml-for-blazor.com/wp-content/uploads/2023/07/Tutorial-DataGrid-and-DataForm.png?resize=980%2C657&ssl=1)
   - ![DataGrid and DataForm Running](https://i0.wp.com/xaml-for-blazor.com/wp-content/uploads/2023/07/Tutorial-DataGrid-and-DataForm-running1.png?resize=863%2C690&ssl=1)
   - ![DataForm Validation](https://i0.wp.com/xaml-for-blazor.com/wp-content/uploads/2023/07/Tutorial-DataForm-validation.png?resize=551%2C181&ssl=1)
   
   *注意：* 要在编辑 DataForm 时更新 Blazor HTML 表格，需注册 **EditEnded** 事件并调用 `StateHasChanged()`：
   - ![DataForm EditEnded – Screenshot 1](https://i0.wp.com/xaml-for-blazor.com/wp-content/uploads/2023/07/Tutorial-DataForm-EditEnded3.png?resize=895%2C414&ssl=1)
   - ![DataForm EditEnded – Screenshot 2](https://i0.wp.com/xaml-for-blazor.com/wp-content/uploads/2023/07/Tutorial-DataForm-EditEnded2.png?resize=980%2C504&ssl=1)

5. **创建一个 XAML UserControl**  
   - 右键单击项目，选择**添加**，然后**新建项...**。
   - 点击**显示所有模板**并选择 **XAML UserControl (XAML for Blazor)**。
   - 将其命名为 **UserControl1** 并添加一个名为 **ViewModel1** 的新类。
   
   **UserControl1.xaml:**
   
   ```xml
   <UserControl x:Class="BlazorApp1.UserControl1"
                xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
       <StackPanel Orientation="Vertical">
           <TextBlock FontSize="18">
               当前计数：<Run Text="{Binding CurrentCount}" />
           </TextBlock>
           <Button Content="增加计数"
                   Click="ButtonIncrementCount_Click"
                   Margin="0,20,0,0"
                   FontSize="18"
                   HorizontalAlignment="Left" />
       </StackPanel>
   </UserControl>
   ```
   
   **UserControl1.xaml.cs:**
   
   ```csharp
   using System.Windows;
   using System.Windows.Controls;

   namespace BlazorApp1
   {
       public partial class UserControl1 : UserControl
       {
           readonly ViewModel1 _viewModel = new ViewModel1();

           public UserControl1()
           {
               InitializeComponent();
               DataContext = _viewModel;
           }

           private void ButtonIncrementCount_Click(object sender, RoutedEventArgs e)
           {
               _viewModel.CurrentCount++;
           }
       }
   }
   ```
   
   **ViewModel1.cs:**
   
   ```csharp
   using System.ComponentModel;
   using System.Runtime.CompilerServices;

   namespace BlazorApp1
   {
       public class ViewModel1 : INotifyPropertyChanged
       {
           public int _currentCount;
           public int CurrentCount
           {
               get => _currentCount;
               set
               {
                   if (_currentCount == value) return;
                   _currentCount = value;
                   OnPropertyChanged();
               }
           }

           public event PropertyChangedEventHandler? PropertyChanged;

           protected void OnPropertyChanged([CallerMemberName] string callerName = "")
           {
               PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(callerName));
           }
       }
   }
   ```
   
   在 **Index.razor** 中测试 **UserControl1**：
   
   ```razor
   <XamlForBlazor.XamlElement Type="@typeof(UserControl1)" />
   ```
   
   Screenshot:
   
   ![Add UserControl1 to Index](https://i0.wp.com/xaml-for-blazor.com/wp-content/uploads/2023/07/Tutorial-Add-UserControl1-to-Index.png?resize=959%2C591&ssl=1)
   
   运行应用程序：
   
   ![UserControl1 Running](https://i0.wp.com/xaml-for-blazor.com/wp-content/uploads/2023/07/Tutorial-UserControl1-running.png?resize=835%2C469&ssl=1)

---

## 如果我还有其他问题怎么办？

如有更多问题，请联系：  
[xaml-for-blazor@userware.onmicrosoft.com](mailto:xaml-for-blazor@userware.onmicrosoft.com)