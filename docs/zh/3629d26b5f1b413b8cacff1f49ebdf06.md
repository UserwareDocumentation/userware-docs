# OpenSilver 开发者指南：WPF 迁移

本指南专为希望将应用程序迁移到 OpenSilver 的 WPF 开发者设计。OpenSilver 是一个强大的框架，能够将基于 XAML 的应用程序转换为现代 Web 环境，在 Web 环境中完美实现了 WPF 的核心架构和开发范式。它不仅保持了对 WPF 的基于 CustomControl 的架构支持，还通过 WebAssembly 技术实现了高性能的 Web 应用程序。

## 目录

1. 概述
2. 核心架构
3. 自定义控件
4. MVVM 架构
5. 资源管理
6. Web 平台集成
7. 与 WPF 的差异和迁移策略
8. 迁移策略和流程
9. 开发环境设置
10. 社区和资源

## 1. 概述

OpenSilver 最初作为 Silverlight 的现代替代品，已经成功将全球众多遗留应用程序迁移到 Web 环境。它是一个强大的解决方案，使基于 XAML 和 .NET 的应用程序能够在现代 Web 浏览器中运行。来自各种平台的应用程序，包括 WPF、Xamarin、UWP、WinUI 3、.NET MAUI、Uno Platform 和 AvaloniaUI，都可以迁移到 Web 环境，同时保持高度兼容性。

**主要特点**

* 基于 WebAssembly 的原生性能
* WPF CustomControl 架构实现
* 灵活的 XAML 和 Web 技术集成
* 企业级开发方法支持
* WPF 级别的动画实现

通过利用 WebAssembly 技术，OpenSilver 提供了类似原生的性能，高效处理复杂的业务逻辑和数据处理。这一优势在大型企业应用中尤为明显。

WPF CustomControl 架构已在 Web 环境中完美实现。包括 ControlTemplate 自定义、模板部件和视觉状态在内的所有功能都得到了完全支持，允许以相同的方式实现复杂的 UI 结构和交互。

## 2. 核心架构

OpenSilver 在 Web 环境中实现了 WPF 的核心架构。使用 WebAssembly 技术，它提供接近原生的性能，并允许开发者使用 Visual Studio 的调试环境，为 WPF 开发者提供熟悉的开发体验。

**架构特性**

* 原生 WPF 项目结构
* SPA 路由系统
* MVVM 架构模式
* 依赖注入框架
* 项目分发结构
* 模块化和视图注入

OpenSilver 保持了 WPF 的现有项目结构和开发方法，同时提供现代 Web 开发的优势。开发者可以完全相同地使用基于 XAML 的 UI 定义和代码后置模式，最大限度地减少现有 WPF 开发者的学习曲线。通过基于 Window 的依赖注入和服务结构维护应用程序的一致性。

## 3. 自定义控件

OpenSilver 在 Web 环境中忠实地实现了 WPF 的 CustomControl 架构。它支持基本的 WPF 控件，并通过 ControlTemplate 实现广泛的自定义。在 WPF 中开发的复杂自定义控件可以通过最少的修改进行重用，并且可以原样使用包括视觉状态、触发器和动画在内的 WPF 丰富的 UI 功能。

**核心特性**

* WPF 标准控件库实现
* ControlTemplate 和 DataTemplate 系统
* DependencyProperty 支持
* 事件路由系统

OpenSilver 的 CustomControl 架构继承了 WPF 的核心控件系统。通过 ControlTemplate 可以广泛地自定义控件的外观和行为，而 ContentControl 和 ItemsControl 等基本控件以与 WPF 相同的结构运作。

模板系统包含了 WPF 的核心功能。可以通过 ControlTemplate 重新定义控件外观，并通过 DataTemplate 和 DataTemplateSelector 实现数据驱动的动态 UI 生成。这个模板系统以与 WPF 相同的模式运作，增强了现有模板代码的可重用性。

## 4. MVVM 架构

OpenSilver 提供对 WPF 的 MVVM 架构的完整支持，并与各种 MVVM 框架兼容。模型-视图-视图模型模式的核心元素可以在 Web 环境中以相同的方式实现，允许原样使用现有的 WPF 应用程序架构。像 CommunityToolkit.MVVM 这样基于 .NET Standard 2.0 的 XAML 框架可以直接使用，通过经过验证的工具和模式实现稳定的应用程序开发。

**核心特性**

* 数据绑定系统
* 命令模式实现
* 属性更改通知
* 依赖注入支持

数据绑定系统实现了 WPF 所有强大的绑定功能。它支持包括 OneWay、TwoWay 和 OneWayToSource 在内的各种绑定模式，并通过 IValueConverter、MultiBinding 和 PriorityBinding 实现高级绑定场景。

命令模式忠实地遵循 WPF 的实现。支持通过 ICommand 接口的命令处理和通过 CanExecute 的命令激活管理，并且可以使用像 RelayCommand 或 DelegateCommand 这样的常见命令模式实现。同样支持通过 RoutedCommand 的全局命令处理和通过 InputBinding 的键盘快捷键设置。

通过 INotifyPropertyChanged 接口实现属性更改通知。ViewModel 属性更改会自动反映在 UI 中，并且通过 ObservableCollection 的集合更改通知也得到支持。这使得能够有效地实现响应式 UI。



## 3. 自定义控件

OpenSilver 在 Web 环境中忠实地实现了 WPF 的 CustomControl 架构。它支持基本的 WPF 控件，并通过 ControlTemplate 实现广泛的自定义。在 WPF 中开发的复杂自定义控件可以通过最少的修改进行重用，并且可以原样使用包括视觉状态、触发器和动画在内的 WPF 丰富的 UI 功能。

**核心特性**

* WPF 标准控件库实现
* ControlTemplate 和 DataTemplate 系统
* DependencyProperty 支持
* 事件路由系统

OpenSilver 的 CustomControl 架构继承了 WPF 的核心控件系统。通过 ControlTemplate 可以广泛地自定义控件的外观和行为，而 ContentControl 和 ItemsControl 等基本控件以与 WPF 相同的结构运作。

模板系统包含了 WPF 的核心功能。可以通过 ControlTemplate 重新定义控件外观，并通过 DataTemplate 和 DataTemplateSelector 实现数据驱动的动态 UI 生成。这个模板系统以与 WPF 相同的模式运作，增强了现有模板代码的可重用性。

## 4. MVVM 架构

OpenSilver 提供对 WPF 的 MVVM 架构的完整支持，并与各种 MVVM 框架兼容。模型-视图-视图模型模式的核心元素可以在 Web 环境中以相同的方式实现，允许原样使用现有的 WPF 应用程序架构。像 CommunityToolkit.MVVM 这样基于 .NET Standard 2.0 的 XAML 框架可以直接使用，通过经过验证的工具和模式实现稳定的应用程序开发。

**核心特性**

* 数据绑定系统
* 命令模式实现
* 属性更改通知
* 依赖注入支持

数据绑定系统实现了 WPF 所有强大的绑定功能。它支持包括 OneWay、TwoWay 和 OneWayToSource 在内的各种绑定模式，并通过 IValueConverter、MultiBinding 和 PriorityBinding 实现高级绑定场景。

命令模式忠实地遵循 WPF 的实现。支持通过 ICommand 接口的命令处理和通过 CanExecute 的命令激活管理，并且可以使用像 RelayCommand 或 DelegateCommand 这样的常见命令模式实现。同样支持通过 RoutedCommand 的全局命令处理和通过 InputBinding 的键盘快捷键设置。

通过 INotifyPropertyChanged 接口实现属性更改通知。ViewModel 属性更改会自动反映在 UI 中，并且通过 ObservableCollection 的集合更改通知也得到支持。这使得能够有效地实现响应式 UI。

## 5. 资源管理

OpenSilver 为 WPF 的强大资源管理系统提供完整支持。通过 StaticResource 和 DynamicResource 可以实现灵活的资源管理，并且可以通过层级资源字典结构实现系统化的资源管理。

**核心特性**

* StaticResource/DynamicResource 系统
* 层级资源字典结构
* 主题和国际化支持
* 运行时资源管理

OpenSilver 的资源管理系统直接遵循 WPF 的设计理念。通过 StaticResource 可以在编译时实现优化的资源引用，通过 DynamicResource 可以在运行时动态更改资源。这种双重资源引用系统在性能和灵活性之间提供了平衡。

资源字典可以从应用程序范围的全局资源到组件级别的本地资源进行层级组织。这种系统化的结构使得能够有效实现像 Material Design 或 Fluent Design 这样的现代设计系统。

## 6. Web 平台集成

OpenSilver 提供 XAML 应用程序和 Web 平台之间的自然交互。特别是，可以通过像 HTMLPresenter 这样的特殊控件在 XAML 中完美集成 Web 内容，所有 XAML 元素都设计为能够与 Web 平台有效交互。

**核心特性**

* HTMLPresenter 控件支持
* XAML-Web 元素交互
* 原生脚本集成
* 双向通信系统

OpenSilver 设计为自然地为所有 XAML 控件和布局元素添加 Web 相关属性。通过这种方式，现有的 XAML 元素可以直接利用 Web 平台功能，与 JavaScript 的双向通信也能顺畅进行。

原生脚本集成得到了系统化的实现。可以直接从 XAML 代码调用 JavaScript 函数，反过来，也可以从 JavaScript 利用 XAML 控件功能。这种灵活的交互在将复杂的 Web 功能集成到 XAML 应用程序时特别有用。

HTMLPresenter 能够在 XAML 应用程序中完美渲染和控制 Web 内容。特别是，在 WPF 中使用 CefSharp 或 WebView 实现的 Web 视图区域可以通过 HTMLPresenter 轻松迁移和重用，维持现有的混合应用程序 Web 集成结构。

这种系统化的交互支持是 OpenSilver 的主要优势之一。在迁移 WPF 应用程序时需要的 Web 功能可以自然添加，同时维持现有的基于 XAML 的代码结构，还能利用强大的 Web 平台功能。

## 7. 与 WPF 的差异和迁移策略

虽然 OpenSilver 在 Web 环境中实现了 WPF 的核心架构，但由于 Web 平台的特性，存在一些基本差异。这些差异可以通过 Web 标准 API 和服务器集成有效解决，在某些领域甚至提供了增强的功能。

**主要差异和解决方案**

* 文件系统访问限制
* 数据存储和管理
* 应用程序生命周期
* 安全性和认证框架

文件系统访问是 Web 平台的一个基本限制。虽然在客户端无法通过 System.IO 直接访问文件系统，但可以通过以下替代方案实现文件相关操作：
- 通过服务器 API 处理文件：通过向服务器发送请求处理文件操作任务
- 使用 Web 标准文件 API 实现文件上传/下载
- 通过 HTML5 拖放 API 支持文件拖放
- 通过剪贴板 API 实现复制/粘贴功能
特别是，这些 Web 标准 API 能够在浏览器安全策略范围内实现安全的文件操作。

## 8. 迁移策略和流程

OpenSilver 完美实现了 WPF 的核心设计架构，允许 WPF 项目几乎原样转换为 OpenSilver 项目。像 XAML 使用语法、Generic.xaml 系统和资源字典系统这样的 WPF 核心元素都得到了相同的实现，对现有代码只需要最小的结构性更改。包括 Window、UserControl 和 ContentControl 在内的所有核心 WPF 控件和布局系统都以相同的方式提供，允许原样重用 XAML 标记。

**核心迁移元素**

* 项目结构转换
* 触发器替代策略
* 平台依赖解决
* 渐进式转换方法

## 9. 开发环境设置

OpenSilver 通过 Visual Studio 和 Visual Studio Code 支持在 Windows、macOS 和 Linux 等所有主要操作系统上进行开发。它基于 .NET 9.0 提供尖端的开发环境，特别是在 Windows 环境中，通过 WPF 模拟器实现无需虚拟 Web 托管的直接开发和测试。

**核心开发环境**

* 跨平台工具支持
* 集成调试环境
* WPF 模拟
* 开发生产力工具

## 10. 社区和资源

OpenSilver 通过活跃的开源社区提供持续的演进和支持。通过官方 GitHub 仓库和文档可以获取最新更新和详细的技术信息，通过社区可以分享各种实际迁移经验和解决方案。特别是，通过 OpenSilver 技术人员、布道师和核心贡献者的积极参与社区，持续分享最新的开发趋势和实践经验。

**资源和支持**

* OpenSilver GitHub 仓库
* OpenSilver 官方文档
* 问题追踪和讨论板
* 示例项目和演示

官方文档提供迁移所需的所有技术信息。在 OpenSilver 官方文档网站上提供包括本指南在内的详细技术文档，并持续更新。特别是，随着新版本的发布，最新功能和改进会反映在文档中，允许参考始终最新的信息。

通过 GitHub 仓库（github.com/opensilver/opensilver），可以直接访问项目源代码，通过问题追踪器可以进行问题解决和功能请求。特别是，在迁移过程中发现的 bug 和改进可以直接报告并参与解决过程，为项目质量改进做出贡献。

社区支持是分享 OpenSilver 用户实际经验的重要渠道。可以通过 GitHub Discussions 和 Stack Overflow 等平台与其他开发者分享迁移经验并讨论问题解决方法。OpenSilver 布道师和核心贡献者积极参与分享技术建议和最新开发案例，使社区成员能够获得可应用于实际项目的经过验证的解决方案和最佳实践。

OpenSilver 还为企业客户提供专业的迁移支持服务。通过建立定制的迁移策略、技术咨询和针对个别企业需求的直接开发支持，支持大规模 WPF 应用程序的成功迁移。特别是对于具有复杂业务逻辑或众多自定义控件的企业应用程序，可以通过 OpenSilver 团队的专业支持实现稳定高效的迁移。